apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: forward-auth
  namespace: frigate
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: frigate
  oidc:
    provider:
      issuer: https://authentik.mcswain.dev/application/o/frigate/
    clientIDRef:
      name: oidc
    clientSecret:
      name: oidc
    scopes: [frigate, openid, profile, offline_access]
    forwardAccessToken: true
    disableTokenEncryption: true
  jwt:
    providers:
      - name: authentik
        issuer: https://authentik.mcswain.dev/application/o/frigate/
        remoteJWKS:
          uri: https://authentik.mcswain.dev/application/o/frigate/jwks/
        claimToHeaders:
          - header: x-frigate-username
            claim: preferred_username
          - header: x-frigate-role
            claim: frigate-role
          - header: X-Proxy-Secret
            claim: ak_proxy.frigate_proxy_secret
